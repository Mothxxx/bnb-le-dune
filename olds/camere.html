<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <title>Info Camere</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
  
  <!-- Slick Carousel CSS -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/slick-carousel@1.8.1/slick/slick.css"/>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/slick-carousel@1.8.1/slick/slick-theme.css"/> 
  <link rel="stylesheet" href="{{ url_for('static', filename='css/camere.css') }}">

  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <!-- Lightbox CSS -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/lightbox2/2.11.3/css/lightbox.min.css">
  
  <!-- jQuery -->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  
  <!-- Slick Carousel JS -->
  <script src="https://cdn.jsdelivr.net/npm/slick-carousel@1.8.1/slick/slick.min.js"></script>
  
  <!-- Lightbox JS -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/lightbox2/2.11.3/js/lightbox.min.js"></script>
  
  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-LT0K5MHG56"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-LT0K5MHG56');
  </script>
</head>
<body>

<a href="{{ url_for('index') }}" class="back-link">‚Üê</a>

{% for room in rooms %}
<section id="room-{{ room.id }}" class="room-details">
  
  <!-- AGGIUNGI PULSANTE "VEDI DETTAGLI" -->
  <div class="room-header">
    <h2>{{ room.name }}</h2>
    <a href="{{ url_for('camera_detail', room_id=room.id) }}" class="detail-button">Vedi Dettagli</a>
  </div>

  <!-- Carosello principale -->
  <div class="gallery">
    <div id="sliderSyncingNav{{ loop.index }}" class="js-slick-carousel u-slick mb-2"
         data-infinite="true"
         data-nav-for="#sliderSyncingThumb{{ loop.index }}">
      {% for image in room.images %}
      <div class="js-slide">
        <div class="img-container">
          <a href="{{ image }}" data-lightbox="gallery-{{ room.id }}">
            <img class="img-fluid" src="{{ image }}" alt="Immagine principale {{ loop.index }}">
          </a>
        </div>
      </div>
      {% endfor %}
    </div>
  </div>

  <!-- Carosello anteprime -->
  <div id="sliderSyncingThumb{{ loop.index }}" class="js-slick-carousel u-slick u-slick--gutters-1 u-slick--transform-off"
       data-infinite="true"
       data-slides-show="{{ room.images|length }}"
       data-is-thumbs="true"
       data-nav-for="#sliderSyncingNav{{ loop.index }}">
    {% for image in room.images %}
    <div class="js-slide" style="cursor:pointer;">
      <img class="img-fluid" src="{{ image }}" alt="Anteprima {{ loop.index }}">
    </div>
    {% endfor %}
  </div>

  <!-- Descrizione camera -->
  <div class="room-description">
    <div class="room-comforts">
      <h3>Comfort</h3>
      <ul>
        {% for comfort in room.comforts %}
        <li>{{ comfort }}</li>
        {% endfor %}
      </ul>
    </div>
  </div>
</section>
{% endfor %}

<script>
$(document).ready(function(){
  {% for room in rooms %}
    $('#sliderSyncingNav{{ loop.index }}').slick({
      infinite: true,
      arrows: true,
      fade: true,
      asNavFor: '#sliderSyncingThumb{{ loop.index }}',
    });
    $('#sliderSyncingThumb{{ loop.index }}').slick({
      infinite: false,
      slidesToShow: {{ room.images|length }},
      slidesToScroll: {{ room.images|length }},
      asNavFor: '#sliderSyncingNav{{ loop.index }}',
      focusOnSelect: true,
      arrows: false,
      centerMode: false,
      draggable: true,
      swipe: true,
      responsive: [
        { breakpoint: 992, settings: { slidesToShow: 2 } },
        { breakpoint: 768, settings: { slidesToShow: {{ room.images|length }}, slidesToScroll: {{ room.images|length }}, centerMode:false, focusOnSelect:false } },
        { breakpoint: 480, settings: { slidesToShow: {{ room.images|length }}, slidesToScroll: {{ room.images|length }}, centerMode:false, focusOnSelect:false } }
      ]
    });
  {% endfor %}
});
</script>

<script>
document.addEventListener('DOMContentLoaded', function () {
    let isScrolling = false;
    const sections = Array.from(document.querySelectorAll('.room-details'));

    function scrollToSection(index) {
        if(index >=0 && index < sections.length){
            isScrolling = true;
            sections[index].scrollIntoView({ behavior: 'smooth', block: 'start' });
            setTimeout(() => isScrolling = false, 500);
        }
    }

    function getCurrentSectionIndex() {
        const viewportHeight = window.innerHeight;
        for(let i=0; i<sections.length; i++){
            const rect = sections[i].getBoundingClientRect();
            if(rect.top >=0 && rect.top < viewportHeight) return i;
        }
        return -1;
    }

    document.addEventListener('wheel', function(event){
        if(isScrolling) return;
        const delta = Math.sign(event.deltaY);
        if(Math.abs(event.deltaY)<10) return;
        const currentIndex = getCurrentSectionIndex();
        if(currentIndex===-1) return;
        if(delta>0 && currentIndex<sections.length-1) scrollToSection(currentIndex+1);
        else if(delta<0 && currentIndex>0) scrollToSection(currentIndex-1);
    });

    // Gestione hash URL per scroll automatico
    if (window.location.hash) {
        const targetId = window.location.hash.substring(1);
        const targetSection = document.getElementById(targetId);
        if (targetSection) {
            setTimeout(() => {
                targetSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }, 100);
        }
    }
});
</script>

</body>
</html>